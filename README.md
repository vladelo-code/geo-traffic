![Python](https://img.shields.io/badge/-Python-05122A?style=flat&logo=python)
![FastAPI](https://img.shields.io/badge/-FastAPI-05122A?style=flat&logo=fastapi&logoColor=009688)
![Apache Airflow](https://img.shields.io/badge/-Apache%20Airflow-05122A?style=flat&logo=apache-airflow)
![ClickHouse](https://img.shields.io/badge/-ClickHouse-05122A?style=flat&logo=clickhouse)
![PostgreSQL](https://img.shields.io/badge/-PostgreSQL-05122A?style=flat&logo=postgresql)
![MinIO](https://img.shields.io/badge/-MinIO-05122A?style=flat&logo=minio)
![Docker](https://img.shields.io/badge/-Docker-05122A?style=flat&logo=docker)
![MapLibre](https://img.shields.io/badge/-MapLibre-05122A?style=flat&logo=mapbox)
![Nginx](https://img.shields.io/badge/-Nginx-05122A?style=flat&logo=nginx)
![JavaScript](https://img.shields.io/badge/-JavaScript-05122A?style=flat&logo=javascript)
![HTML5](https://img.shields.io/badge/-HTML5-05122A?style=flat&logo=html5)

# ๐บ๏ธ Geo Traffic โ ะกะธััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ ััะฐัะธะบะฐ ะะพัะบะฒั

> **ะะฝัะตัะฐะบัะธะฒะฝะฐั ะบะฐััะฐ ััะฐัะธะบะฐ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ** ั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะณะตะฝะตัะฐัะธะตะน ะดะฐะฝะฝัั, ััะฐะฝะตะฝะธะตะผ ะฒ ะฐะฝะฐะปะธัะธัะตัะบะพะน ะะ ะธ
> ะฒะธะทัะฐะปะธะทะฐัะธะตะน ะฝะฐ ะบะฐััะต

---

## ๐ฏ ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ

**Geo Traffic** โ ััะพ ะฟะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝะฐั ัะธััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ ะธ ะฒะธะทัะฐะปะธะทะฐัะธะธ ะดะพัะพะถะฝะพะณะพ ััะฐัะธะบะฐ ะฒ ะะพัะบะฒะต. ะกะธััะตะผะฐ
ะฐะฒัะพะผะฐัะธัะตัะบะธ ะณะตะฝะตัะธััะตั ะดะฐะฝะฝัะต ะพ ััะฐัะธะบะต, ัะพััะฐะฝัะตั ะธั ะฒ ััะฐะฝะธะปะธัะต ะธ ะพัะพะฑัะฐะถะฐะตั ะฝะฐ ะธะฝัะตัะฐะบัะธะฒะฝะพะน ะบะฐััะต ั ัะฒะตัะพะฒะพะน
ะธะฝะดะธะบะฐัะธะตะน ะฟัะพะฑะพะบ.

### ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ โจ

- ๐ค **ะะฒัะพะผะฐัะธัะตัะบะฐั ะณะตะฝะตัะฐัะธั** ะดะฐะฝะฝัั ะพ ััะฐัะธะบะต ะบะฐะถะดัะต 5 ะผะธะฝัั
- ๐พ **ะฅัะฐะฝะตะฝะธะต ะดะฐะฝะฝัั** ะฒ ClickHouse ะดะปั ะฐะฝะฐะปะธัะธะบะธ
- ๐ฆ **ะััะธะฒะธัะพะฒะฐะฝะธะต** ััััั ะดะฐะฝะฝัั ะฒ MinIO (S3-ัะพะฒะผะตััะธะผะพะต ััะฐะฝะธะปะธัะต)
- ๐บ๏ธ **ะะฝัะตัะฐะบัะธะฒะฝะฐั ะบะฐััะฐ** ั ัะฒะตัะพะฒะพะน ะธะฝะดะธะบะฐัะธะตะน ะฟัะพะฑะพะบ
- ๐ **ะะฑะฝะพะฒะปะตะฝะธะต ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ** ะดะฐะฝะฝัั ะฝะฐ ะบะฐััะต
- ๐ **ะะฐัััะฐะฑะธััะตะผะฐั ะฐััะธัะตะบัััะฐ** ะฝะฐ ะฑะฐะทะต Docker

---

### ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

- **ะัะบะตัััะฐัะธั:** Apache Airflow 2.8.1
- **ะะฐะทั ะดะฐะฝะฝัั:** ClickHouse (ะฐะฝะฐะปะธัะธะบะฐ), PostgreSQL 13 (ะผะตัะฐะดะฐะฝะฝัะต)
- **ะฅัะฐะฝะธะปะธัะต:** MinIO (S3-ัะพะฒะผะตััะธะผะพะต)
- **Backend:** FastAPI (Python 3.10)
- **Frontend:** MapLibre GL JS, HTML5/CSS3
- **ะะฐััั:** TileServer GL, MBTiles
- **ะะพะฝัะตะนะฝะตัะธะทะฐัะธั:** Docker, Docker Compose

---

## ๐๏ธ ะััะธัะตะบัััะฐ ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        Geo Traffic System                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโ
โ   Airflow   โโโโโโถโ   Generator  โโโโโโถโ traffic.json โ
โ  Scheduler  โ     โ              โ     โ              โ
โโโโโโโโฌโโโโโโโ     โโโโโโโโโโโโโโโโ     โโโโโโโโโโโโฌโโโโ
       โ                                            โ
       โ                                            โ
       โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
       โ                                            โ             โ
       โผ                                            โผ             โผ
โโโโโโโโโโโโโโโโ                           โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ
โ    MinIO     โ                           โ  ClickHouse  โ  โ  PostgreSQL โ
โ S3 ััะฐะฝะธะปะธัะต โ                           โ      ะะ      โ  โ  ะะตัะฐะดะฐะฝะฝัะต โ
โ              โ                           โ              โ  โ   Airflow   โ
โโโโโโโโโโโโโโโโ                           โโโโโโโโฌโโโโโโโโ  โโโโโโโโโโโโโโโ
                                                  โ
                                                  โ
โโโโโโโโโโโโโโโ                            โโโโโโโโดโโโโโโ
โ   FastAPI   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  Frontend  โ
โ  (REST API) โ                            โ  (ะะฐััะฐ)   โ
โโโโโโโโฌโโโโโโโ                            โโโโโโโโโโโโโโ
       โ
       โ
โโโโโโโโดโโโโโโโ
โ  TileServer โ
โ  (ะะตะบัะพัะฝัะต โ
โ    ัะฐะนะปั)   โ
โโโโโโโโโโโโโโโ
```

---

## ๐๏ธ ะกะตัะฒะธัั ะฟัะพะตะบัะฐ

ะัะพะตะบั ัะพััะพะธั ะธะท ัะปะตะดัััะธั ะผะธะบัะพัะตัะฒะธัะพะฒ, ัะฐะทะฒะตัะฝัััั ะฒ Docker:

### 1. ๐ Apache Airflow

**ะะฐะทะฝะฐัะตะฝะธะต:** ะัะบะตัััะฐัะธั ETL-ะฟะฐะนะฟะปะฐะนะฝะฐ

**ะะฟะธัะฐะฝะธะต:**
Airflow ัะฟัะฐะฒะปัะตั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ะฒัะฟะพะปะฝะตะฝะธะตะผ ะทะฐะดะฐั ะฟะพ ะณะตะฝะตัะฐัะธะธ ะธ ะทะฐะณััะทะบะต ะดะฐะฝะฝัั ะพ ััะฐัะธะบะต. DAG ะฝะฐัััะพะตะฝ ะฝะฐ ะทะฐะฟััะบ
ะบะฐะถะดัะต 5 ะผะธะฝัั ะธ ะฒัะฟะพะปะฝัะตั ััะธ ะพัะฝะพะฒะฝัะต ะทะฐะดะฐัะธ:

1. ะะตะฝะตัะฐัะธั ะดะฐะฝะฝัั ะพ ััะฐัะธะบะต
2. ะะฐะณััะทะบะฐ ะฒ MinIO ะดะปั ะฐััะธะฒะธัะพะฒะฐะฝะธั
3. ะะฐะณััะทะบะฐ ะฒ ClickHouse ะดะปั ะฐะฝะฐะปะธัะธะบะธ

**ะะพัั:** `8080`  
**Web UI:** http://localhost:8080  
**ะฃัะตัะฝัะต ะดะฐะฝะฝัะต:** `airflow` / `airflow`

**ะัะฝะพะฒะฝัะต ะบะพะผะฟะพะฝะตะฝัั:**

- **Scheduler** โ ะฟะปะฐะฝะธัะพะฒัะธะบ ะทะฐะดะฐั
- **Webserver** โ ะฒะตะฑ-ะธะฝัะตััะตะนั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ
- **DAG:** `traffic_pipeline` (ะทะฐะฟััะบ ะบะฐะถะดัะต 5 ะผะธะฝัั)

![Airflow UI](screenshots/airflow.png)

---

### 2. ๐พ MinIO (S3-ัะพะฒะผะตััะธะผะพะต ััะฐะฝะธะปะธัะต)

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะพะปะณะพััะพัะฝะพะต ััะฐะฝะตะฝะธะต ััััั ะดะฐะฝะฝัั

**ะะฟะธัะฐะฝะธะต:**
MinIO ะธัะฟะพะปัะทัะตััั ะดะปั ะฐััะธะฒะธัะพะฒะฐะฝะธั ะฒัะตั ัะณะตะฝะตัะธัะพะฒะฐะฝะฝัั ัะฐะนะปะพะฒ `traffic.json`. ะคะฐะนะปั ัะพััะฐะฝััััั ะฒ bucket`geo-traffic`
ั ะฟัะตัะธะบัะพะผ `raw/` ะธ timestamp ะฒ ะธะผะตะฝะธ ัะฐะนะปะฐ.

**ะะพััั:**

- `9000` โ S3 API
- `9001` โ Web UI (ะบะพะฝัะพะปั ัะฟัะฐะฒะปะตะฝะธั)

**Web UI:** http://localhost:9001  
**ะฃัะตัะฝัะต ะดะฐะฝะฝัะต:** `minioadmin` / `minioadmin123`

**Bucket:** `geo-traffic`  
**ะััั ััะฐะฝะตะฝะธั:** `raw/traffic_YYYY-MM-DDTHH:MM:SS.json`

![MinIO Console](screenshots/minio.png)

---

### 3. ๐ ClickHouse

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะฝะฐะปะธัะธัะตัะบะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั ะดะปั ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั ะพ ััะฐัะธะบะต

**ะะฟะธัะฐะฝะธะต:**
ClickHouse ััะฐะฝะธั ะฒัะต ะดะฐะฝะฝัะต ะพ ััะฐัะธะบะต ะฒ ัะฐะฑะปะธัะต `geo_traffic.traffic_grid` ะดะปั ะฑััััะพะณะพ ะฐะฝะฐะปะธัะธัะตัะบะพะณะพ ะดะพัััะฟะฐ. ะะฐะฝะฝัะต
ัะฟะพััะดะพัะตะฝั ะฟะพ ะฒัะตะผะตะฝะฝัะผ ะผะตัะบะฐะผ ะธ ะบะพะพัะดะธะฝะฐัะฐะผ ัะตัะบะธ ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ะทะฐะฟัะพัะพะฒ.

**ะะพัั:** `8123` (HTTP ะธะฝัะตััะตะนั)  
**Web UI:** http://localhost:8123/play

**ะะฐะทะฐ ะดะฐะฝะฝัั:** `geo_traffic`  
**ะขะฐะฑะปะธัะฐ:** `traffic_grid`

**ะัะพะฑะตะฝะฝะพััะธ:**

- ะะฒะธะถะพะบ: `MergeTree`
- ะะฟัะธะผะธะทะฐัะธั ะดะปั ะฒัะตะผะตะฝะฝัั ััะดะพะฒ
- ะะพัััะพัะฝะฐั ะฒััะฐะฒะบะฐ ะดะฐะฝะฝัั (streaming)

![ClickHouse Play](screenshots/clickhouse.png)

---

### 4. ๐ PostgreSQL

**ะะฐะทะฝะฐัะตะฝะธะต:** ะฅัะฐะฝะตะฝะธะต ะผะตัะฐะดะฐะฝะฝัั Airflow

**ะะฟะธัะฐะฝะธะต:**
PostgreSQL ะธัะฟะพะปัะทัะตััั Airflow ะดะปั ััะฐะฝะตะฝะธั ะธะฝัะพัะผะฐัะธะธ ะพ DAG'ะฐั, ะทะฐะดะฐัะฐั, ะทะฐะฟััะบะฐั ะธ ะปะพะณะฐั. ะญัะพ ััะฐะฝะดะฐััะฝะฐั
ะบะพะฝัะธะณััะฐัะธั ะดะปั Airflow.

**ะะพัั:** `5432` (ะฒะฝัััะตะฝะฝะธะน ะดะพัััะฟ)  
**ะะฐะทะฐ ะดะฐะฝะฝัั:** `airflow`  
**ะฃัะตัะฝัะต ะดะฐะฝะฝัะต:** `airflow` / `airflow`

---

### 5. ๐ FastAPI (Backend API)

**ะะฐะทะฝะฐัะตะฝะธะต:** REST API ะดะปั ะฟะพะปััะตะฝะธั ะดะฐะฝะฝัั ะพ ััะฐัะธะบะต

**ะะฟะธัะฐะฝะธะต:**
FastAPI ัะตัะฒะธั ะฟัะตะดะพััะฐะฒะปัะตั ัะฝะดะฟะพะธะฝั `/traffic`, ะบะพัะพััะน ะฒะพะทะฒัะฐัะฐะตั ะฐะบััะฐะปัะฝัะต ะดะฐะฝะฝัะต ะพ ััะฐัะธะบะต ั ะณะตะพะผะตััะธะตะน ะดะพัะพะณ ะดะปั
ะพัะพะฑัะฐะถะตะฝะธั ะฝะฐ ะบะฐััะต. API ะพะฑัะตะดะธะฝัะตั ะดะฐะฝะฝัะต ะธะท ClickHouse ั ะณะตะพะผะตััะธะตะน ะดะพัะพะณ ะธะท JSON ัะฐะนะปะฐ.

**ะะพัั:** `8000`  
**API Endpoint:** http://localhost:8000/traffic  
**API Docs:** http://localhost:8000/docs

**ะัะฝะพะฒะฝัะต ััะฝะบัะธะธ:**

- ะะฐะฟัะพั ะฟะพัะปะตะดะฝะธั ะดะฐะฝะฝัั ะพ ััะฐัะธะบะต ะธะท ClickHouse
- ะกะพะฟะพััะฐะฒะปะตะฝะธะต ั ะณะตะพะผะตััะธะตะน ะดะพัะพะณ (ะฟะพะปะธะปะธะฝะธะธ)
- ะะพะทะฒัะฐั ะดะฐะฝะฝัั ะฒ ัะพัะผะฐัะต GeoJSON

![FastAPI Docs](screenshots/fastapi.png)

---

### 6. ๐ Frontend (ะะฝัะตัะฐะบัะธะฒะฝะฐั ะบะฐััะฐ)

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะธะทัะฐะปะธะทะฐัะธั ััะฐัะธะบะฐ ะฝะฐ ะธะฝัะตัะฐะบัะธะฒะฝะพะน ะบะฐััะต

**ะะฟะธัะฐะฝะธะต:**
ะะตะฑ-ะฟัะธะปะพะถะตะฝะธะต ะฝะฐ ะฑะฐะทะต MapLibre GL JS, ะบะพัะพัะพะต ะพัะพะฑัะฐะถะฐะตั ะดะพัะพะณะธ ะะพัะบะฒั ั ัะฒะตัะพะฒะพะน ะธะฝะดะธะบะฐัะธะตะน ะธะฝัะตะฝัะธะฒะฝะพััะธ ััะฐัะธะบะฐ.
ะะฐััะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปัะตััั ะบะฐะถะดัะต 10 ัะตะบัะฝะด.

**ะะพัั:** `8090`  
**URL:** http://localhost:8090

**ะขะตัะฝะพะปะพะณะธะธ:**

- MapLibre GL JS โ ะฒะตะบัะพัะฝะฐั ะบะฐััะฐ
- TileServer GL โ ะฟะพััะฐะฒะบะฐ ัะฐะนะปะพะฒ
- HTML5 / CSS3 / JavaScript

**ะคัะฝะบัะธะพะฝะฐะป:**

- ๐ ะัะพะฑัะฐะถะตะฝะธะต ะดะพัะพะณ ั ัะฒะตัะพะฒะพะน ะธะฝะดะธะบะฐัะธะตะน (ะบัะฐัะฝัะน = ะฟัะพะฑะบะฐ, ะทะตะปะตะฝัะน = ัะฒะพะฑะพะดะฝะพ)
- ๐ ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ะดะฐะฝะฝัั ะบะฐะถะดัะต 10 ัะตะบัะฝะด
- ๐ ะะฝะพะฟะบะธ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั
- ๐ฑ๏ธ ะะฝัะตัะฐะบัะธะฒะฝะฐั ะบะฐััะฐ ั ะฒะพะทะผะพะถะฝะพัััั ะฟะฐะฝะพัะฐะผะธัะพะฒะฐะฝะธั

**ะฆะฒะตัะพะฒะฐั ััะตะผะฐ:**

- โซ๏ธ **ะะพัะดะพะฒัะน** (0-10 ะบะผ/ั) โ ะถะตััะบะฐั ะฟัะพะฑะบะฐ
- ๐ด **ะัะฐัะฝัะน** (10-20 ะบะผ/ั) โ ัะธะปัะฝะฐั ะฟัะพะฑะบะฐ
- ๐ **ะัะฐะฝะถะตะฒัะน** (20-40 ะบะผ/ั) โ ะฟะปะพัะฝัะน ะฟะพัะพะบ
- ๐ก **ะะตะปััะน** (40-70 ะบะผ/ั) โ ะพะฑััะฝัะน ััะฐัะธะบ
- ๐ข **ะะตะปะตะฝัะน** (70+ ะบะผ/ั) โ ัะฒะพะฑะพะดะฝะพ

![Frontend Map](screenshots/frontend.png)

![Frontend Traffic](screenshots/frontend2.png)

---

### 7. ๐บ๏ธ TileServer GL

**ะะฐะทะฝะฐัะตะฝะธะต:** ะกะตัะฒะตั ะฒะตะบัะพัะฝัั ัะฐะนะปะพะฒ ะดะปั ะบะฐััั

**ะะฟะธัะฐะฝะธะต:**
TileServer GL ะฟัะตะดะพััะฐะฒะปัะตั ะฒะตะบัะพัะฝัะต ัะฐะนะปั ะดะพัะพะณ ะะพัะบะฒั ะฒ ัะพัะผะฐัะต Mapbox Vector Tiles (MVT). ะขะฐะนะปั ะณะตะฝะตัะธัััััั ะธะท
MBTiles ัะฐะนะปะฐ ะธ ััะธะปะธะทััััั ัะพะณะปะฐัะฝะพ ะบะพะฝัะธะณััะฐัะธะธ.

**ะะพัั:** `8081`  
**URL:** http://localhost:8081  
**Style URL:** http://localhost:8081/styles/roads_style/style.json

**ะคะฐะนะปั:**

- `roads_traffic.mbtiles` โ ะฑะฐะทะฐ ะฒะตะบัะพัะฝัั ัะฐะนะปะพะฒ
- `styles/roads_style.json` โ ััะธะปั ะพัะพะฑัะฐะถะตะฝะธั

![TileServer](screenshots/tileserver.png)

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
geo-traffic/
โโโ ๐ airflow/                              # Apache Airflow ะบะพะฝัะธะณััะฐัะธั
โ   โโโ ๐ dags/                             # DAG'ะธ ะธ ัะบัะธะฟัั
โ   โ   โโโ traffic_dag.py                   # ะัะฝะพะฒะฝะพะน DAG ะฟะฐะนะฟะปะฐะนะฝะฐ
โ   โ   โโโ traffic_generator.py             # ะะตะฝะตัะฐัะพั ะดะฐะฝะฝัั ะพ ััะฐัะธะบะต
โ   โ   โโโ roads_moscow.json                # ะะฐะฝะฝัะต ะพ ะดะพัะพะณะฐั ะะพัะบะฒั
โ   โ   โโโ traffic.json                     # ะกะณะตะฝะตัะธัะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต (ะฒัะตะผะตะฝะฝัะน ัะฐะนะป)
โ   โโโ ๐ logs/                             # ะะพะณะธ ะฒัะฟะพะปะฝะตะฝะธั ะทะฐะดะฐั
โ   โโโ ๐ plugins/                          # ะะฐััะพะผะฝัะต ะฟะปะฐะณะธะฝั Airflow
โ
โโโ ๐ api/                                  # FastAPI Backend
โ   โโโ main.py                              # REST API ะดะปั ะฟะพะปััะตะฝะธั ะดะฐะฝะฝัั
โ
โโโ ๐ clickhouse/                           # ClickHouse ะบะพะฝัะธะณััะฐัะธั
โ   โโโ init.sql                             # SQL ัะบัะธะฟั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะะ ะธ ัะฐะฑะปะธั
โ   โโโ ๐ config/
โ       โโโ users.xml                        # ะะพะฝัะธะณััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
โ
โโโ ๐ docker/                               # Docker Compose ะบะพะฝัะธะณััะฐัะธั
โ   โโโ docker-compose.yml                   # ะัะต ัะตัะฒะธัั ะฟัะพะตะบัะฐ
โ
โโโ ๐ frontend-map/                         # Frontend ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ index.html                           # ะะฝัะตัะฐะบัะธะฒะฝะฐั ะบะฐััะฐ
โ
โโโ ๐ generator/                            # ะฃัะธะปะธัั ะดะปั ะณะตะฝะตัะฐัะธะธ ะดะฐะฝะฝัั
โ   โโโ build_moscow_roads.py                # ะะพัััะพะตะฝะธะต ะดะพัะพะถะฝะพะณะพ ะณัะฐัะฐ ะธะท OSM
โ   โโโ build_moscow_roads_geometry.py       # ะะพัััะพะตะฝะธะต ะณะตะพะผะตััะธะธ ะดะพัะพะณ
โ   โโโ build_geojson.py                     # ะะพะฝะฒะตััะฐัะธั ะฒ GeoJSON
โ   โโโ load_road_geometry_to_clickhouse.py  # ะะฐะณััะทะบะฐ ะณะตะพะผะตััะธะธ ะฒ ะะ
โ   โโโ roads_moscow_geometry.json           # ะะตะพะผะตััะธั ะดะพัะพะณ ะฒ JSON
โ 
โโโ ๐ tileserver/                           # ะะพะฝัะธะณััะฐัะธั TileServer
โ   โโโ config.json                          # ะะพะฝัะธะณััะฐัะธั ัะฐะนะปะพะฒ
โ   โโโ roads_traffic.mbtiles                # ะะฐะทะฐ ะฒะตะบัะพัะฝัั ัะฐะนะปะพะฒ
โ   โโโ ๐ styles/
โ       โโโ roads_style.json                 # ะกัะธะปั ะพัะพะฑัะฐะถะตะฝะธั ะดะพัะพะณ
โ
โโโ README.md                                # ะะพะบัะผะตะฝัะฐัะธั ะฟัะพะตะบัะฐ
```

---

## ๐๏ธ ะกัะตะผะฐ ะดะฐะฝะฝัั

### ะะฐะทะฐ ะดะฐะฝะฝัั: `geo_traffic`

#### ะขะฐะฑะปะธัะฐ: `traffic_grid`

ะัะฝะพะฒะฝะฐั ัะฐะฑะปะธัะฐ ะดะปั ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั ะพ ััะฐัะธะบะต.

| ะะพะปะต         | ะขะธะฟ      | ะะฟะธัะฐะฝะธะต                                 |
|--------------|----------|------------------------------------------|
| `ts`         | DateTime | ะัะตะผะตะฝะฝะฐั ะผะตัะบะฐ ะธะทะผะตัะตะฝะธั                |
| `grid_lat`   | Int32    | ะะฝะดะตะบั ััะตะนะบะธ ัะตัะบะธ ะฟะพ ัะธัะพัะต (0-99)     |
| `grid_lon`   | Int32    | ะะฝะดะตะบั ััะตะนะบะธ ัะตัะบะธ ะฟะพ ะดะพะปะณะพัะต (0-99)    |
| `avg_speed`  | Float64  | ะกัะตะดะฝัั ัะบะพัะพััั ะฒ ะบะผ/ั                  |
| `cars_count` | Int32    | ะะพะปะธัะตััะฒะพ ะผะฐัะธะฝ ะฝะฐ ััะฐััะบะต (0-200)      |
| `lat`        | Float64  | ะจะธัะพัะฐ ัะตะฝััะฐ ัะตะณะผะตะฝัะฐ ะดะพัะพะณะธ            |
| `lon`        | Float64  | ะะพะปะณะพัะฐ ัะตะฝััะฐ ัะตะณะผะตะฝัะฐ ะดะพัะพะณะธ           |
| `edge_id`    | String   | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั ัะตะณะผะตะฝัะฐ ะดะพัะพะณะธ |

**ะะฝะดะตะบัั:**

- PRIMARY KEY: `(ts, grid_lat, grid_lon)`
- ENGINE: `MergeTree`

---

## ๐ ะัะพัะตัั ัะฐะฑะพัั

### ะะฑัะฐั ััะตะผะฐ ะฟะฐะนะฟะปะฐะนะฝะฐ

```
1. โฐ Airflow Scheduler ะทะฐะฟััะบะฐะตั DAG ะบะฐะถะดัะต 5 ะผะธะฝัั
   โ
   โโโถ 2. ๐ค ะะตะฝะตัะฐัะธั ะดะฐะฝะฝัั (task: generate)
   โ      โโ ะะฐะณััะถะฐะตั roads_moscow.json
   โ      โโ ะะปั ะบะฐะถะดะพะณะพ ัะตะณะผะตะฝัะฐ ะดะพัะพะณะธ:
   โ      โ   โโ ะะตะฝะตัะธััะตั ัะปััะฐะนะฝะพะต ะบะพะปะธัะตััะฒะพ ะผะฐัะธะฝ (0-200)
   โ      โ   โโ ะะฐัััะธััะฒะฐะตั ััะตะดะฝัั ัะบะพัะพััั (5-80 ะบะผ/ั)
   โ      โ   โโ ะะพะฑะฐะฒะปัะตั ะฒัะตะผะตะฝะฝัั ะผะตัะบั
   โ      โโ ะกะพััะฐะฝัะตั ะฒ traffic.json
   โ
   โโโถ 3. ๐ฆ ะะฐะณััะทะบะฐ ะฒ MinIO (task: upload_minio)
   โ      โโ ะกะพะทะดะฐะตั bucket geo-traffic (ะตัะปะธ ะฝะต ัััะตััะฒัะตั)
   โ      โโ ะะฐะณััะถะฐะตั traffic.json ะฒ raw/traffic_TIMESTAMP.json
   โ      โโ ะััะธะฒะธััะตั ะดะปั ะดะพะปะณะพััะพัะฝะพะณะพ ััะฐะฝะตะฝะธั
   โ
   โโโถ 4. ๐พ ะะฐะณััะทะบะฐ ะฒ ClickHouse (task: load_clickhouse)
         โโ ะงะธัะฐะตั traffic.json ะฟะพัััะพัะฝะพ
         โโ ะัะฟัะฐะฒะปัะตั ะดะฐะฝะฝัะต ะฒ ClickHouse ัะตัะตะท HTTP API
         โโ ะกะพััะฐะฝัะตั ะฒ ัะฐะฑะปะธัั geo_traffic.traffic_grid
```

### ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ััะฐะฟะพะฒ

#### ะญัะฐะฟ 1: ะะตะฝะตัะฐัะธั ะดะฐะฝะฝัั ๐ค

**ะกะบัะธะฟั:** `airflow/dags/traffic_generator.py`

**ะัะพัะตัั:**

1. ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ะพ ะดะพัะพะณะฐั ะธะท `roads_moscow.json`
2. ะััะธัะปะตะฝะธะต ะณัะฐะฝะธั ะพะฑะปะฐััะธ (min/max lat/lon)
3. ะะปั ะบะฐะถะดะพะณะพ ัะตะณะผะตะฝัะฐ ะดะพัะพะณะธ:
    - ะะตะฝะตัะฐัะธั ัะปััะฐะนะฝะพะณะพ ะบะพะปะธัะตััะฒะฐ ะผะฐัะธะฝ (0-200)
    - ะะฐััะตั ััะตะดะฝะตะน ัะบะพัะพััะธ ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะทะฐะณััะถะตะฝะฝะพััะธ:
        - **>150 ะผะฐัะธะฝ:** 0-10 ะบะผ/ั (ะถะตััะบะฐั ะฟัะพะฑะบะฐ) โซ๏ธ
        - **>150 ะผะฐัะธะฝ:** 10-20 ะบะผ/ั (ัะธะปัะฝะฐั ะฟัะพะฑะบะฐ) ๐ด
        - **100-150 ะผะฐัะธะฝ:** 20-40 ะบะผ/ั (ะฟะปะพัะฝัะน ะฟะพัะพะบ) ๐
        - **50-100 ะผะฐัะธะฝ:** 40-70 ะบะผ/ั (ะพะฑััะฝัะน ััะฐัะธะบ) ๐ก
        - **<50 ะผะฐัะธะฝ:** 70+ ะบะผ/ั (ัะฒะพะฑะพะดะฝะพ) ๐ข
    - ะััะธัะปะตะฝะธะต ะธะฝะดะตะบัะพะฒ ัะตัะบะธ (grid_lat, grid_lon)
    - ะคะพัะผะธัะพะฒะฐะฝะธะต ะทะฐะฟะธัะธ ั ะฒัะตะผะตะฝะฝะพะน ะผะตัะบะพะน
4. ะกะพััะฐะฝะตะฝะธะต ะฒัะตั ะทะฐะฟะธัะตะน ะฒ JSON ัะฐะนะป

**ะััะพะดะฝัะต ะดะฐะฝะฝัะต:** `traffic.json` ะฒ ัะพัะผะฐัะต ะผะฐััะธะฒะฐ ะพะฑัะตะบัะพะฒ

#### ะญัะฐะฟ 2: ะะฐะณััะทะบะฐ ะฒ MinIO ๐ฆ

**ะกะบัะธะฟั:** `airflow/dags/traffic_dag.py` โ `upload_to_minio()`

**ะัะพัะตัั:**

1. ะัะพะฒะตัะบะฐ ัััะตััะฒะพะฒะฐะฝะธั bucket `geo-traffic`
2. ะกะพะทะดะฐะฝะธะต bucket ะฟัะธ ะพััััััะฒะธะธ
3. ะะฐะณััะทะบะฐ `traffic.json` ะฒ MinIO
4. ะะผั ะพะฑัะตะบัะฐ: `raw/traffic_YYYY-MM-DDTHH:MM:SS.json`

**ะฆะตะปั:** ะััะธะฒะธัะพะฒะฐะฝะธะต ะฒัะตั ััััั ะดะฐะฝะฝัั ะดะปั ะฟะพัะปะตะดัััะตะณะพ ะฐะฝะฐะปะธะทะฐ ะธ ะฐัะดะธัะฐ

#### ะญัะฐะฟ 3: ะะฐะณััะทะบะฐ ะฒ ClickHouse ๐พ

**ะกะบัะธะฟั:** `airflow/dags/traffic_dag.py` โ `load_clickhouse()`

**ะัะพัะตัั:**

1. ะงัะตะฝะธะต `traffic.json` ะธะท ัะฐะนะปะพะฒะพะน ัะธััะตะผั
2. ะะพัััะพัะฝะฐั ะพัะฟัะฐะฒะบะฐ ะดะฐะฝะฝัั ะฒ ClickHouse (streaming)
3. ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะพัะผะฐัะฐ `JSONEachRow` ะดะปั ัััะตะบัะธะฒะฝะพะน ะฒััะฐะฒะบะธ
4. ะะฐะฟัะพั: `INSERT INTO geo_traffic.traffic_grid FORMAT JSONEachRow`

**ะะฟัะธะผะธะทะฐัะธั:** ะะพัััะพัะฝะฐั ะพัะฟัะฐะฒะบะฐ ะฟัะตะดะพัะฒัะฐัะฐะตั ะฟะตัะตะฟะพะปะฝะตะฝะธะต ะฟะฐะผััะธ ะธ ะพะฑััะฒั ัะพะตะดะธะฝะตะฝะธั

#### ะญัะฐะฟ 4: ะะพะปััะตะฝะธะต ะดะฐะฝะฝัั ัะตัะตะท API ๐

**ะกะตัะฒะธั:** `api/main.py` โ FastAPI

**ะัะพัะตัั:**

1. ะะปะธะตะฝั (Frontend) ะทะฐะฟัะฐัะธะฒะฐะตั `/traffic`
2. API ะทะฐะฟัะฐัะธะฒะฐะตั ะผะฐะบัะธะผะฐะปัะฝัั ะฒัะตะผะตะฝะฝัั ะผะตัะบั ะธะท ClickHouse
3. ะะพะปััะฐะตั ะฒัะต ะทะฐะฟะธัะธ ั ััะพะน ะผะตัะบะพะน
4. ะกะพะฟะพััะฐะฒะปัะตั `edge_id` ั ะณะตะพะผะตััะธะตะน ะธะท `roads_moscow_geometry.json`
5. ะคะพัะผะธััะตั GeoJSON ั ะฟะพะปะธะปะธะฝะธัะผะธ ะดะพัะพะณ
6. ะะพะทะฒัะฐัะฐะตั ะดะฐะฝะฝัะต ะบะปะธะตะฝัั

#### ะญัะฐะฟ 5: ะะธะทัะฐะปะธะทะฐัะธั ะฝะฐ ะบะฐััะต ๐บ๏ธ

**ะกะตัะฒะธั:** `frontend-map/index.html`

**ะัะพัะตัั:**

1. ะะฝะธัะธะฐะปะธะทะฐัะธั ะบะฐััั MapLibre GL ั ัะตะฝััะพะผ ะฒ ะะพัะบะฒะต
2. ะะฐะณััะทะบะฐ ััะธะปั ะธะท TileServer GL
3. ะกะพะทะดะฐะฝะธะต ัะปะพั `traffic-lines` ะดะปั ะพัะพะฑัะฐะถะตะฝะธั ััะฐัะธะบะฐ
4. ะะฐะฟัะพั ะดะฐะฝะฝัั ะธะท FastAPI ะบะฐะถะดัะต 10 ัะตะบัะฝะด
5. ะะฑะฝะพะฒะปะตะฝะธะต GeoJSON ะธััะพัะฝะธะบะฐ ะบะฐััั
6. ะัะธะผะตะฝะตะฝะธะต ัะฒะตัะพะฒะพะน ะธะฝะดะธะบะฐัะธะธ ะฝะฐ ะพัะฝะพะฒะต `avg_speed`

**ะฆะฒะตัะพะฒะฐั ัะบะฐะปะฐ:**

- ะะฝัะตัะฟะพะปััะธั ะพั ะบัะฐัะฝะพะณะพ (0 ะบะผ/ั) ะดะพ ะทะตะปะตะฝะพะณะพ (70+ ะบะผ/ั)

---

## ๐ ะัััััะน ััะฐัั

### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

- Docker ะธ Docker Compose ัััะฐะฝะพะฒะปะตะฝั
- ะะพััั ัะฒะพะฑะพะดะฝั: `8000`, `8080`, `8081`, `8090`, `8123`, `9000`, `9001`

### ะจะฐะณ 1: ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธ ะฝะฐัััะพะนะบะฐ

```bash
cd https://github.com/vladelo-code/geo-traffic
```

### ะจะฐะณ 2: ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ

```bash
cd docker
docker compose up -d
```

ะญัะฐ ะบะพะผะฐะฝะดะฐ ะทะฐะฟัััะธั ะฒัะต ัะตัะฒะธัั:

- โ MinIO
- โ ClickHouse
- โ PostgreSQL
- โ Airflow (init, webserver, scheduler)
- โ FastAPI
- โ Frontend (Nginx)
- โ TileServer GL

**ะัะตะผั ะทะฐะฟััะบะฐ:** ~2-3 ะผะธะฝััั ะดะปั ะฟะตัะฒะพะน ะธะฝะธัะธะฐะปะธะทะฐัะธะธ

### ะจะฐะณ 3: ะัะพัะผะพัั ัะตะทัะปััะฐัะฐ

1. ะัะบัะพะนัะต ะบะฐััั: http://localhost:8090
2. ะะพะดะพะถะดะธัะต ะฝะตัะบะพะปัะบะพ ะผะธะฝัั
3. ะะฐะถะผะธัะต "ะะฑะฝะพะฒะธัั ััะฐัะธะบ" ะดะปั ะฟัะธะฝัะดะธัะตะปัะฝะพะณะพ ะพะฑะฝะพะฒะปะตะฝะธั

**ะะพัะพะฒะพ! ๐ ะะฐััะฐ ะดะพะปะถะฝะฐ ะพัะพะฑัะฐะถะฐัั ะดะพัะพะณะธ ั ัะฒะตัะพะฒะพะน ะธะฝะดะธะบะฐัะธะตะน ััะฐัะธะบะฐ**

---

## ๐ API Endpoints

### GET `/traffic`

ะะพะปััะธัั ะฐะบััะฐะปัะฝัะต ะดะฐะฝะฝัะต ะพ ััะฐัะธะบะต ะดะปั ะฒัะตั ะดะพัะพะณ.

**URL:** http://localhost:8000/traffic

**ะะตัะพะด:** `GET`

**ะัะฒะตั:**

```json
[
  {
    "edge_id": "12345",
    "avg_speed": 35.5,
    "cars_count": 87,
    "polyline": [
      [
        55.7558,
        37.6173
      ],
      [
        55.7559,
        37.6174
      ],
      ...
    ]
  },
  ...
]
```

**ะะฟะธัะฐะฝะธะต:**

- ะะพะทะฒัะฐัะฐะตั ะดะฐะฝะฝัะต ัะพะปัะบะพ ั ะฟะพัะปะตะดะฝะตะน ะฒัะตะผะตะฝะฝะพะน ะผะตัะบะธ
- ะะบะปััะฐะตั ะณะตะพะผะตััะธั ะดะพัะพะณ (ะฟะพะปะธะปะธะฝะธะธ) ะดะปั ะพัะพะฑัะฐะถะตะฝะธั ะฝะฐ ะบะฐััะต
- ะคะพัะผะฐั ะบะพะพัะดะธะฝะฐั: `[lat, lon]` ะดะปั ะบะฐะถะดะพะน ัะพัะบะธ ะฟะพะปะธะปะธะฝะธะธ

```

---

## โ๏ธ ะะฐัััะพะนะบะฐ ะธ ะบะพะฝัะธะณััะฐัะธั

### ะะทะผะตะฝะตะฝะธะต ะธะฝัะตัะฒะฐะปะฐ ะณะตะฝะตัะฐัะธะธ

ะ ัะฐะนะปะต `airflow/dags/traffic_dag.py`:

```python
schedule_interval = "*/5 * * * *",  # ะบะฐะถะดัะต 5 ะผะธะฝัั
```

ะะทะผะตะฝะธัะต ะฝะฐ ะฝัะถะฝัะน ะธะฝัะตัะฒะฐะป (ะฝะฐะฟัะธะผะตั, `"*/10 * * * *"` ะดะปั 10 ะผะธะฝัั).

### ะะฐัััะพะนะบะฐ ะณะตะฝะตัะฐัะพัะฐ ััะฐัะธะบะฐ

ะ ัะฐะนะปะต `airflow/dags/traffic_generator.py`:

```python
GRID_LAT_CELLS = 100  # ะะพะปะธัะตััะฒะพ ััะตะตะบ ัะตัะบะธ ะฟะพ ัะธัะพัะต
GRID_LON_CELLS = 100  # ะะพะปะธัะตััะฒะพ ััะตะตะบ ัะตัะบะธ ะฟะพ ะดะพะปะณะพัะต
```

### ะะฐัััะพะนะบะฐ ัะฐััะพัั ะพะฑะฝะพะฒะปะตะฝะธั ะบะฐััั

ะ ัะฐะนะปะต `frontend-map/index.html`:

```javascript
setInterval(loadTraffic, 10000);  // 10 ัะตะบัะฝะด (ะฒ ะผะธะปะปะธัะตะบัะฝะดะฐั)
```

---

## ๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธ

### Airflow Logs

ะะพะณะธ ะฒัะฟะพะปะฝะตะฝะธั ะทะฐะดะฐั ะดะพัััะฟะฝั ะฒ Airflow UI:

- ะะตัะตะนะดะธัะต ะฒ DAG โ ะัะฑะตัะธัะต ะทะฐะฟััะบ โ ะัะบัะพะนัะต ะทะฐะดะฐัั โ ะะฐะถะผะธัะต "Log"

**ะะพะบะฐะปัะฝะพะต ัะฐัะฟะพะปะพะถะตะฝะธะต:** `airflow/logs/`

### ClickHouse Logs

ะะพะณะธ ะดะพัััะฟะฝั ัะตัะตะท Docker:

```bash
docker logs geo-clickhouse
```

### FastAPI Logs

```bash
docker logs traffic_api
```

---

## ๐ ะฃัะตัะฝัะต ะดะฐะฝะฝัะต ะฟะพ ัะผะพะปัะฐะฝะธั

| ะกะตัะฒะธั     | URL                   | ะะพะณะธะฝ        | ะะฐัะพะปั          |
|------------|-----------------------|--------------|-----------------|
| Airflow    | http://localhost:8080 | `airflow`    | `airflow`       |
| MinIO      | http://localhost:9001 | `minioadmin` | `minioadmin123` |
| ClickHouse | http://localhost:8123 | `default`    | (ะฟัััะพ)         |

โ๏ธ **ะะฝะธะผะฐะฝะธะต:** ะญัะพ ััะตัะฝัะต ะดะฐะฝะฝัะต ะดะปั ัะฐะทัะฐะฑะพัะบะธ! ะ production ะธัะฟะพะปัะทัะนัะต ะฝะฐะดะตะถะฝัะต ะฟะฐัะพะปะธ.

---

## ๐ฌ **ะะพะฝัะฐะบัั**

ะะฒัะพั: ะะปะฐะดะธัะปะฐะฒ ะะฐััะธะพะฝะพะฒ  
GitHub: [vladelo-code](https://github.com/vladelo-code)  
Gitverse: [vladelo](https://gitverse.ru/vladelo/Song-Hunter-Bot)  
Telegram: [@vladelo](https://t.me/vladelo)

๐ ะะต ะทะฐะฑัะดััะต ะฟะพััะฐะฒะธัั ะทะฒะตะทะดั โญ ะฝะฐ GitHub, ะตัะปะธ ะฒะฐะผ ะฟะพะฝัะฐะฒะธะปัั ะฟัะพะตะบั! ๐